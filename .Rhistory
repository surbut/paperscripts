xlim=c(40,80),
risk.table = F,
pval = TRUE,
risk.table.col = "strata",
fun="cumhaz",
xlim = c(0, 15),
xlab = "Time of Event (age in years)",
ylab = "Cumulative Hazard",
main = "Cumulative Hazard by PRS Category",
legend.title = "Age Category",
legend.labs = c("PRS <20%","PRS 20%-80%","PRS>80%"))
fit <-
survfit(Surv(phenos.CAD_censor_age, phenos.has_CAD) ~ ascvdcat_all,
data = df)
g_all = ggsurvplot(
fit,
conf.int = TRUE,
#ggtheme = theme_classic(base_size =15),
xlim = c(40, 80),
risk.table = F,
pval = TRUE,
risk.table.col = "strata",
fun = "cumhaz",
xlab = "Time of Event (age in years)",
ylab = "Cumulative Hazard",
main = "Cumulative Hazard by PRS Category",
legend.title = "Age Category",
legend.labs = c("PRS <20%", "PRS 20%-80%", "PRS>80%")
)
g_all
fit<- survfit(Surv(time, status) ~ sex, data = lung)
# Basic survival curves
ggsurvplot(fit, data = lung)
# Customized survival curves
ggsurvplot(fit, data = lung,
surv.median.line = "hv", # Add medians survival
# Change legends: title & labels
legend.title = "Sex",
legend.labs = c("Male", "Female"),
# Add p-value and tervals
pval = TRUE,
conf.int = TRUE,
# Add risk table
risk.table = TRUE,
tables.height = 0.2,
tables.theme = theme_cleantable(),
# Color palettes. Use custom color: c("#E7B800", "#2E9FDF"),
# or brewer color (e.g.: "Dark2"), or ggsci color (e.g.: "jco")
palette = c("#E7B800", "#2E9FDF"),
ggtheme = theme_bw() # Change ggplot2 theme
)
# Change font size, style and color
#++++++++++++++++++++++++++++++++++++
## Not run:
# Change font size, style and color at the same time
ggsurvplot(fit, data = lung,  main = "Survival curve",
font.main = c(16, "bold", "darkblue"),
font.x = c(14, "bold.italic", "red"),
font.y = c(14, "bold.italic", "darkred"),
font.tickslab = c(12, "plain", "darkgreen"))
## End(Not run)
dyoung=df[df$phenos.enrollment<55,]
dyoung$pce.age=scale(dyoung$ascvd_10y_accaha_all)
dyoung$pce.r=rank(dyoung$pce.age)/length(dyoung$pce.age)
dyoung$pce.cat=cut(dyoung$pce.r,breaks=c(0,0.20,0.80,1))
fit <- survfit(Surv((phenos.CAD_censor_age-phenos.enrollment), phenos.has_CAD) ~pce.cat, data=dyoung)
g_young=ggsurvplot(fit,
xlim = c(0,15),
risk.table = F,
pval = TRUE,
#risk.table.col = "strata",
fun = "cumhaz",
xlab = "Time since Enrollment",
ylab = "Cumulative Hazard",
#main = "Cumulative Hazard by PCE Category",
legend.title = "Age Category",
legend.labs = c("Age specific PCE 20 percentile","Age specific PCE 20-80 percentile","Age specific PCE > 20 percentile"))
fit <- survfit(Surv((phenos.CAD_censor_age-phenos.enrollment), phenos.has_CAD) ~prscat, data=df[df$phenos.enrollment<55,])
g_young=ggsurvplot(fit,
pval = TRUE, conf.int = TRUE,
##risk.table = F,
##risk.table.col = "strata",
fun="cumhaz",
xlim = c(0, 15),
xlab = "Time since Enrollment",
ylab = "Cumulative Hazard",
main = "Cumulative Hazard by PRS Category since Enrollment, Enrollment <55",
legend.title = "PRS Category",
legend.labs = c("PRS <20%", "PRS 20%-80%", "PRS >80%"))
g_young
quantile(dyoung$ascvd_10y_accaha_all,probs = c(0,1,by=0.10))
quantile(dyoung$ascvd_10y_accaha_all,probs = seq(0,1,by=0.10))
quantile(dmid$ascvd_10y_accaha_all,probs = seq(0,1,by=0.10))
quantile(df$ascvd_10y_accaha_all[df$phenos.enrollment>55&df$phenos.enrollment<65],probs = seq(0,1,by=0.10))
rbind(quantile(dyoung$ascvd_10y_accaha_all,probs = seq(0,1,by=0.10)),df$ascvd_10y_accaha_all[df$phenos.enrollment>65],probs = seq(0,1,by=0.10),df$ascvd_10y_accaha_all[df$phenos.enrollment>55&df$phenos.enrollment<65],probs = seq(0,1,by=0.10))
quantile(dyoung$ascvd_10y_accaha_all,probs = seq(0,1,by=0.10))
rbind(quantile(dyoung$ascvd_10y_accaha_all,probs = seq(0,1,by=0.10)),quantile(df$ascvd_10y_accaha_all[df$phenos.enrollment>65],probs = seq(0,1,by=0.10)),quantile(df$ascvd_10y_accaha_all[df$phenos.enrollment>55&df$phenos.enrollment<65],probs = seq(0,1,by=0.10)))
q=rbind(quantile(dyoung$ascvd_10y_accaha_all,probs = seq(0,1,by=0.10)),quantile(df$ascvd_10y_accaha_all[df$phenos.enrollment>65],probs = seq(0,1,by=0.10)),quantile(df$ascvd_10y_accaha_all[df$phenos.enrollment>55&df$phenos.enrollment<65],probs = seq(0,1,by=0.10)))
rownames(q)=c("<55","55-65","65+")
q
q=rbind(quantile(dyoung$ascvd_10y_accaha_all,probs = seq(0,1,by=0.10)),quantile(df$ascvd_10y_accaha_all[df$phenos.enrollment>55&df$phenos.enrollment<65],probs = seq(0,1,by=0.10)),quantile(df$ascvd_10y_accaha_all[df$phenos.enrollment>65],probs = seq(0,1,by=0.10)))
rownames(q)=c("<55","55-65","65+")
q
dyoung=df[df$phenos.enrollment<55,]
dyoung$pce.age=scale(dyoung$ascvd_10y_accaha_all)
dyoung$pce.r=rank(dyoung$ascvd_10y_accaha_all)/length(dyoung$ascvd_10y_accaha_all)
dyoung$pce.cat=cut(dyoung$pce.r,breaks=c(0,0.20,0.80,1))
fit <- survfit(Surv((phenos.CAD_censor_age-phenos.enrollment), phenos.has_CAD) ~pce.cat, data=dyoung)
g_young=ggsurvplot(fit,
xlim = c(0,15),
risk.table = F,
pval = TRUE,
#risk.table.col = "strata",
fun = "cumhaz",
xlab = "Time since Enrollment",
ylab = "Cumulative Hazard",
#main = "Cumulative Hazard by PCE Category",
legend.title = "Percentile Category",
legend.labs = c("Age specific PCE 20 percentile","Age specific PCE 20-80 percentile","Age specific PCE > 20 percentile"))
g_young
library(ggplot2)
library(gridExtra)
# Create 9 sample ggplots
fit <- survfit(Surv(phenos.CAD_censor_age, phenos.has_CAD) ~prscat, data=df)
g_all= ggsurvplot(fit,
pval = TRUE, conf.int = TRUE,
#risk.table = TRUE,
#risk.table.col = "strata",
fun="cumhaz",
xlim = c(40,80),
xlab = "Time of Event (age in years)",
ylab = "Cumulative Hazard",
#main = "Cumulative Hazard by PCE Category",
legend.title = "PRS Category",
legend.labs = c("PRS<20%", "PRS 20%-80%", "PRS>80%"))
```
```{r}
g_all
plots <- list()
plots[[1]] <- g_all
```
## Now we stratify by PCE category, again for all
```{r}
fit <-
survfit(Surv(phenos.CAD_censor_age, phenos.has_CAD) ~ ascvdcat_all,
data = df)
g_all = ggsurvplot(
fit,
conf.int = TRUE,
#ggtheme = theme_classic(base_size =15),
xlim = c(40, 80),
risk.table = F,
pval = TRUE,
risk.table.col = "strata",
fun = "cumhaz",
xlab = "Time of Event (age in years)",
ylab = "Cumulative Hazard",
main = "Cumulative Hazard by PRS Category",
legend.title = "10 year risk Category",
legend.labs = c("10-yr risk <7.5%","10-yr risk 7.5-20%","10-yr risk >7.5%"))
```
```{r,fig}
g_all
plots[[2]] <- g_all
```
## Now we plot cumulative incidence by age of enrollment
```{r}
df$agecat=cut(df$enroll_age,breaks=c(0,55,65,100),labels=c("<55","55-65","65+"))
fit <- survfit(Surv((phenos.CAD_censor_age-phenos.enrollment), phenos.has_CAD) ~agecat, data=df)
genroll=ggsurvplot(fit, data = df,
pval = TRUE, conf.int = TRUE,
risk.table = F,
risk.table.col = "strata",
fun="cumhaz",
xlim = c(0, 15),
xlab = "Time since Enrollment",
ylab = "Cumulative Hazard",
main = "Cumulative Hazard by Age Category since Enrollment",
legend.title = "Age Category",
legend.labs = c("Age <55", "Age 55-65", "Age >65"))
genroll
plots[[3]] <- g_enroll
```
# Age cat specific plots
# Here we break into three age groups and stratify by PRS, asking about resolution by PRS:
```{r}
fit <- survfit(Surv((phenos.CAD_censor_age-phenos.enrollment), phenos.has_CAD) ~prscat, data=df[df$phenos.enrollment<55,])
g_young=ggsurvplot(fit,
pval = TRUE, conf.int = TRUE,
##risk.table = F,
##risk.table.col = "strata",
fun="cumhaz",
xlim = c(0, 15),
xlab = "Time since Enrollment",
ylab = "Cumulative Hazard",
main = "Cumulative Hazard by PRS Category since Enrollment, Enrollment <55",
legend.title = "PRS Category",
legend.labs = c("PRS <20%", "PRS 20%-80%", "PRS >80%"))
fit <- survfit(Surv((phenos.CAD_censor_age-phenos.enrollment), phenos.has_CAD) ~prscat, data=df[df$phenos.enrollment>55&df$phenos.enrollment<65,])
g_mid=ggsurvplot(fit,
pval = TRUE, conf.int = TRUE,
#risk.table = TRUE,
#risk.table.col = "strata",
fun="cumhaz",
xlim = c(0, 15),
xlab = "Time since Enrollment",
ylab = "Cumulative Hazard",
main = "Cumulative Hazard by PRS Category since Enrollment, Enrollment 55-65",
legend.title = "PRS Category",
legend.labs = c("PRS <20%", "PRS 20%-80%", "PRS >80%"))
###
fit <- survfit(Surv((phenos.CAD_censor_age-phenos.enrollment), phenos.has_CAD) ~prscat, data=df[df$phenos.enrollment>65,])
g_old=ggsurvplot(fit,
pval = TRUE, conf.int = TRUE,
#risk.table = TRUE,
#risk.table.col = "strata",
fun="cumhaz",
xlim = c(0, 15),
xlab = "Time since Enrollment",
ylab = "Cumulative Hazard",
main = "Cumulative Hazard by PRS Category since Enrollment, Enrollment >55",
legend.title = "PRS Category",
legend.labs = c("PRS <20%", "PRS 20%-80%", "PRS >80%"))
#
# fit <- survfit(Surv((phenos.CAD_censor_age-phenos.enrollment),phenos.has_CAD)~prscat, data=df[df$phenos.enrollment>65,])
#
#
# g_old=ggsurvplot(fit,
#            conf.int = TRUE,
#            ggtheme = theme_classic(base_size =15),fun = "cumhaz",xlab="Time since enrollment",#risk.table = T)
#
#
#
# fit <- survfit(Surv((phenos.CAD_censor_age-phenos.enrollment), phenos.has_CAD) ~prscat, data=df[df$phenos.enrollment<55,])
#
# g_young=ggsurvplot(fit,
#            conf.int = TRUE,
#            ggtheme = theme_classic(base_size =15),fun = "cumhaz",xlab="Time since enrollment",#risk.table = T)
#
#
# fit <- survfit(Surv(phenos.CAD_censor_age, phenos.has_CAD) ~prscat, data=df[df$phenos.enrollment>65,])
#
#
# g_young=ggsurvplot(fit,
#            conf.int = TRUE,
#            ggtheme = theme_classic(base_size =15),fun = "cumhaz",xlab="Event Age",#risk.table = T,xlim=c(40,70))
#
# fit <- survfit(Surv(phenos.CAD_censor_age, phenos.has_CAD) ~pce, data=df[df$phenos.enrollment>55&df$phenos.enrollment<65,])
#
# g_mid=ggsurvplot(fit,
#            conf.int = TRUE,
#            ggtheme = theme_classic(base_size =15),fun = "cumhaz",xlim=c(50,70),xlab="Age",#risk.table = T)
#
#
# fit <- survfit(Surv(phenos.CAD_censor_age, phenos.has_CAD) ~pce, data=df[df$phenos.enrollment>65,])
#
# g_old=ggsurvplot(fit,
#            conf.int = TRUE,
#            ggtheme = theme_classic(base_size =15),fun = "cumhaz",xlim=c(60,80),xlab="Age",#risk.table = T)
```
## <55
```{r,fig.height=8,fig.width=6}
g_young
plots[[4]]=g_young
```
## 55-65
```{r,fig.height=8,fig.width=6}
g_mid
plots[[5]]=g_mid
```
## >65
```{r,fig.height=8,fig.width=6}
g_old
plots[[6]]=g_old
```
# Here we do the same for PCE:age normalized percentile
- here we standardize PCE distribution within each age to ~N(0,1)
- we look at bottom 20%, mid 20%, and top 20%
- I also do the same for nominal 10 year category with caveat that 10 year risk category is a low number in young folks
```{r}
dyoung=df[df$phenos.enrollment<55,]
dyoung$pce.age=scale(dyoung$ascvd_10y_accaha_all)
dyoung$pce.r=rank(dyoung$ascvd_10y_accaha_all)/length(dyoung$ascvd_10y_accaha_all)
dyoung$pce.cat=cut(dyoung$pce.r,breaks=c(0,0.20,0.80,1))
fit <- survfit(Surv((phenos.CAD_censor_age-phenos.enrollment), phenos.has_CAD) ~pce.cat, data=dyoung)
g_young=ggsurvplot(fit,
xlim = c(0,15),
risk.table = F,
pval = TRUE,
#risk.table.col = "strata",
fun = "cumhaz",
xlab = "Time since Enrollment",
ylab = "Cumulative Hazard",
#main = "Cumulative Hazard by PCE Category",
legend.title = "Percentile Category",
legend.labs = c("Age specific PCE 20 percentile","Age specific PCE 20-80 percentile","Age specific PCE > 20 percentile"))
###
dmid=df[df$phenos.enrollment>55&df$phenos.enrollment<65,]
dmid$pce.age=scale(dmid$ascvd_10y_accaha_all)
dmid$pce.r=rank(dmid$pce.age)/length(dmid$pce.age)
dmid$pce.cat=cut(dmid$pce.r,breaks=c(0,0.20,0.80,1))
fit <- survfit(Surv((phenos.CAD_censor_age-phenos.enrollment), phenos.has_CAD)~pce.cat, data=dmid)
g_mid=ggsurvplot(fit,
xlim = c(0,15),
risk.table = F,
pval = TRUE,
#risk.table.col = "strata",
fun = "cumhaz",
xlab = "Time since Enrollment",
ylab = "Cumulative Hazard",
#main = "Cumulative Hazard by PCE Category",
legend.title = "Percentile Category",
legend.labs = c("Age specific PCE 20 percentile","Age specific PCE 20-80 percentile","Age specific PCE > 20 percentile"))
####
dold=df[df$phenos.enrollment>65,]
dold$pce.age=scale(dold$ascvd_10y_accaha_all)
dold$pce.r=rank(dold$pce.age)/length(dold$pce.age)
dold$pce.cat=cut(dold$pce.r,breaks=c(0,0.20,0.80,1))
fit <- survfit(Surv((phenos.CAD_censor_age-phenos.enrollment), phenos.has_CAD) ~pce.cat, data=dold)
g_old=ggsurvplot(fit,
xlim = c(0,15),
risk.table = F,
pval = TRUE,
#risk.table.col = "strata",
fun = "cumhaz",
xlab = "Time since Enrollment",
ylab = "Cumulative Hazard",
#main = "Cumulative Hazard by PCE Category",
legend.title = "Percentile Category",
legend.labs = c("Age specific PCE 20 percentile","Age specific PCE 20-80 percentile","Age specific PCE > 20 percentile"))
```
## <55
```{r,fig.height=8,fig.width=6}
g_young
plots[[7]]=g_young
```
## 55-65
```{r,fig.height=8,fig.width=6}
g_mid
plots[[8]]=g_mid
```
## >65
```{r,fig.height=8,fig.width=6}
g_old
plots[[9]]=g_old
```
# Age specific with PCE category
```{r}
dyoung=df[df$phenos.enrollment<55,]
dyoung$pce.age=scale(dyoung$ascvd_10y_accaha_all)
dyoung$pce.r=rank(dyoung$pce.age)/length(dyoung$pce.age)
dyoung$pce.cat=cut(dyoung$pce.r,breaks=c(0,0.20,0.80,1))
fit <- survfit(Surv((phenos.CAD_censor_age-phenos.enrollment), phenos.has_CAD)~ascvdcat_all, data=dyoung)
g_young=ggsurvplot(fit,
xlim = c(0,15),
risk.table = F,
pval = TRUE,
#risk.table.col = "strata",
fun = "cumhaz",
xlab = "Time since Enrollment",
ylab = "Cumulative Hazard",
#main = "Cumulative Hazard by PCE Category",
legend.title = "10 year risk Category",
legend.labs = c("10-yr risk <7.5%","10-yr risk 7.5-20%","10-yr risk >7.5%"))
###
dmid=df[df$phenos.enrollment>55&df$phenos.enrollment<65,]
dmid$pce.age=scale(dmid$ascvd_10y_accaha_all)
dmid$pce.r=rank(dmid$pce.age)/length(dmid$pce.age)
dmid$pce.cat=cut(dmid$pce.r,breaks=c(0,0.20,0.80,1))
fit <- survfit(Surv((phenos.CAD_censor_age-phenos.enrollment), phenos.has_CAD)~ascvdcat_all, data=dmid)
g_mid=ggsurvplot(fit,
xlim = c(0,15),
risk.table = F,
pval = TRUE,
#risk.table.col = "strata",
fun = "cumhaz",
xlab = "Time since Enrollment",
ylab = "Cumulative Hazard",
#main = "Cumulative Hazard by PCE Category",
legend.title = "10 year risk Category",
legend.labs = c("10-yr risk <7.5%","10-yr risk 7.5-20%","10-yr risk >7.5%"))
####
dold=df[df$phenos.enrollment>65,]
dold$pce.age=scale(dold$ascvd_10y_accaha_all)
dold$pce.r=rank(dold$pce.age)/length(dold$pce.age)
dold$pce.cat=cut(dold$pce.r,breaks=c(0,0.20,0.80,1))
fit <- survfit(Surv((phenos.CAD_censor_age-phenos.enrollment), phenos.has_CAD) ~ascvdcat_all, data=dold)
g_old=ggsurvplot(fit,
xlim = c(0,15),
risk.table = F,
pval = TRUE,
#risk.table.col = "strata",
fun = "cumhaz",
xlab = "Time since Enrollment",
ylab = "Cumulative Hazard",
#main = "Cumulative Hazard by PCE Category",
legend.title = "10 -year risk Category",
legend.labs = c("10-yr risk <7.5%","10-yr risk 7.5-20%","10-yr risk >7.5%"))
```
## <55
```{r,fig.height=8,fig.width=6}
g_young
```
## 55-65
```{r,fig.height=8,fig.width=6}
g_mid
```
## 65 +
```{r,fig.height=8,fig.width=6}
g_old
```
# Put together
```{r}
# Arrange the plots in a 3x3 grid
grid.arrange(
arrangeGrob(grobs = plots[1:3], ncol = 3, top = "a"),
arrangeGrob(grobs = plots[4:6], ncol = 3, top = "b"),
arrangeGrob(grobs = plots[7:9], ncol = 3, top = "c"),
nrow = 3
)
```
grid.arrange(
arrangeGrob(grobs = plots[1:3], ncol = 3, top = "a"),
arrangeGrob(grobs = plots[4:6], ncol = 3, top = "b"),
arrangeGrob(grobs = plots[7:9], ncol = 3, top = "c"),
nrow = 3
)
class(plots)
grid.arrange(
arrangeGrob(grobs = plots[1:3], ncol = 3, top = "a"),
arrangeGrob(grobs = plots[4:6], ncol = 3, top = "b"),
arrangeGrob(grobs = plots[7:9], ncol = 3, top = "c"),
nrow = 3
)
class(plots[[1]])
class(g_mid)
class(plot(g_old))
class(g_old)
plot(g_old)
fit <- survfit(Surv(time, status) ~ sex, data = lung)
# Create a ggsurvplot
ggsurv <- ggsurvplot(fit)
# Extract the ggplot object
ggplot_obj <- plot(ggsurv)
arrange_ggsurvplots(plot, print = TRUE,
ncol = 3, nrow = 3, risk.table.height = 0.4)
arrange_ggsurvplots(plots, print = TRUE,
ncol = 3, nrow = 3)
class(plots)
require("survival")
fit<- survfit(Surv(time, status) ~ sex, data = lung)
# List of ggsurvplots
require("survminer")
splots <- list()
splots[[1]] <- ggsurvplot(fit, data = lung, risk.table = TRUE, ggtheme = theme_minimal())
splots[[2]] <- ggsurvplot(fit, data = lung, risk.table = TRUE, ggtheme = theme_grey())
# Arrange multiple ggsurvplots and print the output
arrange_ggsurvplots(splots, print = TRUE,
ncol = 2, nrow = 1, risk.table.height = 0.4)
require("survival")
fit<- survfit(Surv(time, status) ~ sex, data = lung)
# List of ggsurvplots
require("survminer")
splots <- list()
splots[[1]] <- ggsurvplot(fit, data = lung, risk.table = TRUE, ggtheme = theme_minimal())
splots[[2]] <- ggsurvplot(fit, data = lung, risk.table = TRUE, ggtheme = theme_grey())
# Arrange multiple ggsurvplots and print the output
arrange_ggsurvplots(splots, print = TRUE,
ncol = 2, nrow = 1, risk.table.height = 0.4)
arrange_ggsurvplots(splots, print = TRUE,ncol = 2, nrow = 1, risk.table.height = 0.4)
class(plots)
class(plots[[1]])
class(plots[[2]])
class(plots[[3]])
class(plots[[4]])
plots[[3]] <- genroll
plot(seq(1:10))
dev.new()
plot(seq(1:10))
arrange_ggsurvplots(splots, print = TRUE,ncol = 2, nrow = 1, risk.table.height = 0.4)
arrange_ggsurvplots(plots, print = TRUE,ncol = 3, nrow = 3)
library(grDevices)
library(grDevices)
arrange_ggsurvplots(plots[1:3], print = TRUE,ncol = 3, nrow = 1)
require("survival")
fit<- survfit(Surv(time, status) ~ sex, data = lung)
# List of ggsurvplots
require("survminer")
splots <- list()
splots[[1]] <- ggsurvplot(fit, data = lung, risk.table = TRUE, ggtheme = theme_minimal())
splots[[2]] <- ggsurvplot(fit, data = lung, risk.table = TRUE, ggtheme = theme_grey())
# Arrange multiple ggsurvplots and print the output
arrange_ggsurvplots(splots, print = TRUE,
ncol = 2, nrow = 1, risk.table.height = 0.4)
plot(seq(1:10))
gc()
plot(seq(1:10))
dev.new()
plot(seq(1:10))
require("survival")
fit<- survfit(Surv(time, status) ~ sex, data = lung)
# List of ggsurvplots
require("survminer")
splots <- list()
splots[[1]] <- ggsurvplot(fit, data = lung, risk.table = TRUE, ggtheme = theme_minimal())
splots[[2]] <- ggsurvplot(fit, data = lung, risk.table = TRUE, ggtheme = theme_grey())
# Arrange multiple ggsurvplots and print the output
arrange_ggsurvplots(splots, print = TRUE,
ncol = 2, nrow = 1, risk.table.height = 0.4)
saveRDS(plots,"~/paperscripts/output/plotslitCI.rds")
gc()
saveRDS(plots,"~/paperscripts/output/plotslitCI.rds")
