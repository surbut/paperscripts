levels(m2$Model)=c("Clinical","Clinical + Genomic")
gplot2 <- ggplot(m,aes(x = Age,y = AUC,color = Model,ymin=AUC+se,ymax=AUC-se))+geom_point()+geom_line(aes(group=Model,color =Model),linewidth=3)+geom_pointrange()+ylim(0.5,1)+scale_color_manual(values=c("tomato","cornflowerblue","darkorchid4"))+theme_classic(base_size = 25)+theme(axis.text.x = element_text(angle = 90))
gplot2
levels(m2$Model)
gplot2 <- ggplot(m2,aes(x = Age,y = AUC,color = Model,ymin=AUC+se,ymax=AUC-se))+geom_point()+geom_line(aes(group=Model,color =Model),linewidth=3)+geom_pointrange()+ylim(0.5,1)+scale_color_manual(values=c("tomato","cornflowerblue","darkorchid4"))+theme_classic(base_size = 25)+theme(axis.text.x = element_text(angle = 90))
gplo2
gplot2
gplot2 <- ggplot(m2,aes(x = Age,y = AUC,color = Model,ymin=AUC+se,ymax=AUC-se))+geom_point()+geom_line(aes(group=Model,color =Model),linewidth=3)+geom_pointrange()+ylim(0.5,0.8)+scale_color_manual(values=c("tomato","cornflowerblue","darkorchid4"))+theme_classic(base_size = 25)+theme(axis.text.x = element_text(angle = 90))
ggsave(gplot2,filename = "Figs/Fig5/aucplot_onlytwo.tiff",dpi=300,width = 9,height = 7)
head()
zph=readRDS("~/paperscripts/output/zph_amit_EQ.rds")
colnames(zph)=c("Polygenic Score","Pooled Cohort Equations","Low-density lipoprotein","Smoking","Age","Systolic blood pressure","Diabetes","Body Mass Index","Male Sex","High-density Lipoprotein","Total cholesterol","age")
library(reshape2)
library(ggplot2)
library(dplyr)
m=melt(zph,id.vars = "age")
head(m)
tgt = c("Polygenic Score","Pooled Cohort Equations","Low-density lipoprotein","Smoking","Systolic blood pressure","Diabetes","Male Sex","High-density Lipoprotein","Total cholesterol","age")
dat = m %>% filter(variable %in% tgt)
p <- ggplot(dat, aes(factor(variable), value)) +
geom_boxplot(width = 0.5, outlier.size = 3, outlier.color = "darkred",
fill = "lightblue", color = "darkblue") +
facet_wrap(~variable, scales = "free") +
labs(x = "", y = "Value", title = "Distribution of P Value for Cox Zph") +
theme(plot.title = element_text(size = 20, hjust = 0.5),
axis.text.x = element_blank(),
axis.title = element_text(size = 20),
strip.text = element_text(size = 10, face = "bold"))+theme_classic()
# Show plot
p
p <- ggplot(dat, aes(factor(variable), value)) +
geom_boxplot(width = 0.5, outlier.size = 3, outlier.color = "darkred",
fill = "lightblue", color = "darkblue") +
facet_wrap(~variable, scales = "free") +
labs(x = "", y = "Value", title = "Distribution of p-Value against Non-proportional hazards") +
theme(plot.title = element_text(size = 20, hjust = 0.5),
axis.text.x = element_blank(),
axis.title = element_text(size = 20),
strip.text = element_text(size = 10, face = "bold"))+theme_classic()
# Show plot
p
barplot(-log10(as.matrix(ps)),las=2,xlab="Variable",ylab="-log10pvalue",main="-log10p: Model without stratification by age of enrollment")
df = readRDS("output/amit_df.rds")
## make sure normalized
df$prs_quant = scale(df$SCORE)
df$prs.r = (rank(df$prs_quant) / length(df$prs_quant))
df$round_age = round(df$phenos.enrollment, 0)
df$ldl.quant = scale(df$ldladj)
df$sbp.quant = scale(df$sbp)
df$hdl.quant = scale(df$hdladj)
df$chol.quant = scale(df$choladj)
df$age.quant = scale(df$phenos.enrollment)
df$bmi.quant = scale(df$bmi)
df$phenos.has_CAD = df$has_disease
df$sex = ifelse(df$sex == "male", 1, 0)
library(survival)
library(ggplot2)
library(dplyr)
library(survminer)
# Fit 6 Cox regression models
fit1 <- coxph(Surv(phenos.CAD_censor_age, phenos.has_CAD) ~ prs_quant, data = df)
cox.zph.fit <- cox.zph(fit1)
ggcoxzph(cox.zph.fit)
fit2 <- coxph(Surv(phenos.CAD_censor_age, phenos.has_CAD) ~ ascvd_10y_accaha_all, data = df)
cox.zph.fit <- cox.zph(fit2)
ggcoxzph(cox.zph.fit)
fit3 <- coxph(Surv(phenos.CAD_censor_age, phenos.has_CAD)~ ldl.quant, data = df)
cox.zph.fit <- cox.zph(fit3)
ggcoxzph(cox.zph.fit)
fit4 <- coxph(Surv(phenos.CAD_censor_age, phenos.has_CAD) ~ hdl.quant, data = df)
cox.zph.fit <- cox.zph(fit4)
ggcoxzph(cox.zph.fit)
fit5 <- coxph(Surv(phenos.CAD_censor_age, phenos.has_CAD)~ sbp.quant, data = df)
cox.zph.fit <- cox.zph(fit5)
ggcoxzph(cox.zph.fit)
fit6 <- coxph(Surv(phenos.CAD_censor_age, phenos.has_CAD) ~ chol.quant, data = df)
cox.zph.fit <- cox.zph(fit6)
ggcoxzph(cox.zph.fit)
fit7 <- coxph(Surv(phenos.CAD_censor_age, phenos.has_CAD) ~ prev_disease_dm, data = df)
cox.zph.fit <- cox.zph(fit7)
ggcoxzph(cox.zph.fit)
fit8 <- coxph(Surv(phenos.CAD_censor_age, phenos.has_CAD) ~ sex, data = df)
cox.zph.fit <- cox.zph(fit8)
ggcoxzph(cox.zph.fit)
ps=readRDS("output/zph_all.rds")
barplot(-log10(as.matrix(ps)),las=2,xlab="Variable",ylab="-log10pvalue",main="-log10p: Model without stratification by age of enrollment")
head(ps)
ps=ps[-c("age.zph","bmi.zph")]
ps=ps[,-c("age.zph","bmi.zph")]
head(ps)
class(ps)
ps=ps[,-("age.zph")]
ps=ps[,-ps$age.zph]
head(ps)
ps=readRDS("output/zph_all.rds")
ps[,-"age.zph"]
ps[-"age.zph"]
d = subset(ps, select = -c("age.zph","bmi.zph") )
d = subset(ps, select = -c(age.zph,bmi.zph) )
head(d)
ps = subset(ps, select = -c(age.zph,bmi.zph) )
ps
ps=readRDS("output/zph_all.rds")
ps = subset(ps, select = -c(age.zph,bmi.zph) )
colnames(ps)=c("Polygenic Score","Pooled Cohort Equations","Low-density lipoprotein","Smoking","Systolic blood pressure","Diabetes","Male Sex","High-density Lipoprotein","Total cholesterol")
barplot(-log10(as.matrix(ps)),las=2,xlab="Variable",ylab="-log10pvalue",main="-log10p: Model without stratification by age of enrollment")
-log10(0.05)
plot(-log10(as.matrix(ps)),las=2,xlab="Variable",ylab="-log10pvalue",main="-log10p: Model without stratification by age of enrollment")
plot(colnames(ps),-log10(as.matrix(ps)),las=2,xlab="Variable",ylab="-log10pvalue",main="-log10p: Model without stratification by age of enrollment")
barplot(-log10(as.matrix(ps)),las=2,xlab="Variable",ylab="-log10pvalue",main="-log10p: Model without stratification by age of enrollment")
ps
melt(ps)
ggplot(mp,aes(x=variable,y=value,col=variable))+geom_bar("identity")
mp=melt(ps)
ggplot(mp,aes(x=variable,y=value,col=variable))+geom_bar("identity")
ggbarplot
ggplot(mp,aes(x=variable,y=value))+geom_bar(stat = "identity")
ggplot(mp,aes(x=variable,y=-log10(value)))+geom_bar(stat = "identity")
ggplot(mp,aes(x=variable,y=-log10(value),fill=variable))+geom_bar(stat = "identity")
ggplot(mp,aes(x=variable,y=-log10(value),fill=variable))+geom_bar(stat = "identity")+theme_classic(base_size = 15)
ggplot(mp,aes(x=variable,y=-log10(value),fill=variable))+geom_bar(stat = "identity")+theme_classic(base_size = 15)+theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
ggplot(mp,aes(x=variable,y=-log10(value),fill=variable))+geom_bar(stat = "identity")+theme_classic(base_size = 15)+theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+labs(x="Risk Factor",fill="Risk Factor")
ggarrange(p,bar,labels=c("A.","B."))
bar=ggplot(mp,aes(x=variable,y=-log10(value),fill=variable))+geom_bar(stat = "identity")+theme_classic(base_size = 15)+theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+labs(x="Risk Factor",fill="Risk Factor")
ggarrange(p,bar,labels=c("A.","B."))
ggarrange(p,bar,labels=c("A.","B."),nrow=2)
bar=ggplot(mp,aes(x=variable,y=-log10(value),fill=variable))+geom_bar(stat = "identity")+theme_classic(base_size = 10)+theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+labs(x="Risk Factor",fill="Risk Factor")
ggarrange(p,bar,labels=c("A.","B."),nrow=2,heights = c(6,3))
bar=ggplot(mp,aes(x=variable,y=-log10(value),fill=variable))+geom_bar(stat = "identity")+theme_classic(base_size = 10)+theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+labs(x="Risk Factor",fill="Risk Factor")
ga=ggarrange(p,bar,labels=c("A.","B."),nrow=2)
ggsave(ga,filename = "Figs/zph.tiff",dpi=300)
r2_pce=readRDS("output/r2pce_sd.rds")
hall_pce=readRDS("output/hallpce_sd.rds")
r2_pce=readRDS("output/r2pce_sd.rds")
g=ggarrange(hall_pce,r2_pce,ncol=2,labels=c("C.","D."))
ggsave(g,filename = "Docs/Figs/PCEsd.tiff",dpi=300,width=10,height=5)
sum(df$Race=="white")
mean(df$Race=="white")
fhs=readRDS("output/fh_full.rds")
str(fhs)
fhs$DMRX1
sum(na.omit(fhs$DMRX1))
mean(na.omit(fhs$DMRX1))
g
ggsave(g,filename = "Docs/Figs/PCEsd.tiff",dpi=300,width=10,height=5)
ggsave(g,filename = "Figs/PCEsd.tiff",dpi=300,width=10,height=5)
g=ggarrange(hall_pce+theme_classic(base_size = 10),r2_pce+theme_classic(base_size = 10),ncol=2,labels=c("C.","D."))
ggsave(g,filename = "Figs/PCEsd.tiff",dpi=300,width=10,height=5)
g=ggarrange(hall_pce+theme_classic(base_size = 15),r2_pce+theme_classic(base_size = 15),ncol=2,labels=c("C.","D."))
ggsave(g,filename = "Figs/PCEsd.tiff",dpi=300,width=10,height=5)
g=ggarrange(hall_pce+theme_classic(base_size = 15),r2_pce+theme_classic(base_size = 15),ncol=2,labels=c("C.","D."),legend = NULL)
ggsave(g,filename = "Figs/PCEsd.tiff",dpi=300,width=10,height=5)
g=ggarrange(hall_pce+theme_classic(base_size = 15),r2_pce+theme_classic(base_size = 15),ncol=2,labels=c("C.","D."),legend = NULL)
g
g=ggarrange(hall_pce+theme_classic(base_size = 15),r2_pce+theme_classic(base_size = 15),ncol=2,labels=c("C.","D."),legend = "none")
ggsave(g,filename = "Figs/PCEsd.tiff",dpi=300,width=10,height=5)
mean(df$prev_disease_dm)
library('data.table')
library("CVrisk")
library("dplyr")
#######
prs=fread("~/Dropbox/phenotypes/CAD_prs.txt")
dim(na.omit(prs))
# 487409      3
cad_pheno=fread("~/Dropbox (Personal)/phenotypes/UKBB_HardCAD_202109.tsv")[,c(1:7,10)]
#cad_pheno=fread("~/Dropbox (Personal)/phenotypes/Coronary_Artery_Disease_HARD.tab.tsv")[,c(1:8,11)]
cad_pheno[cad_pheno$prevalent_disease==1,"incident_disease"]=0
cad_pheno$phenos.enrollment=cad_pheno$enroll_age
cad_pheno$phenos.has_CAD=cad_pheno$has_disease
dim(cad_pheno)
# 502485      7 Starting with
###
d2=fread("~/Dropbox/output/Diabetes_Type_2.tab.tsv.gz")
d2[d2$prevalent_disease==1,"incident_disease"]=0
d3=data.frame(sample_id=d2$sample_id,prev_disease_dm=d2$prevalent_disease,inc_disease_dm=d2$incident_disease)
cad_pheno=merge(cad_pheno,d3,by="sample_id")
dim(cad_pheno)
# 502485      9
m=merge(prs,cad_pheno,by.x = "SAMPLE",by.y = "sample_id")
dim(m)
# 487276      9 that have wc'd prs
#subeject with pheno and no PRS
nrow(cad_pheno)-nrow(m)
### lipids info
lipids=fread("~/Dropbox/ukbb-lipids-meds.txt")
sum(rowSums(is.na(lipids[,c("eid","statin0","ldladj","hdladj","choladj","anylipidmed0")]))>0)
# exclude 73414
# exclude TG for original table
lip=na.omit(lipids[,c("eid","statin0","ldladj","hdladj","choladj","anylipidmed0","trigadj")])
dim(lip)
# 429122     6
# baselin info
ukb=fread("~/Dropbox/big_ukb_file.txt",header=T,sep="\t")
cov=data.frame("iid"=ukb$id,"sex"=ukb$Sex,"sbp"=ukb$SBP_adjMeds,"dbp"=ukb$DBP_adjMeds,"smoke"=ukb$SmokingStatus,"bp_med"=ukb$BP_Meds,"Race"=ukb$in_white_British_ancestry_subset,"bmi"=ukb$BMI)
cov$Race=ifelse(cov$Race==1,"white","other")
## exclude DBP for original table
##
sum(rowSums(is.na(cov))>0)
## exclude 48973 without baseling info
dim(cov)
cov=na.omit(cov)
dim(na.omit(cov))
# 453656      8
length(setdiff(prs$SAMPLE,cad_pheno$sample_id))
# 133 individuals had PRS and not phenotypes,
m2=merge(m,cov,by.x = "SAMPLE",by.y = "iid")
dim(na.omit(m2))
# 452641     18
## difference in baseline covariates
nrow(m)-nrow(m2)
df=merge(lip,m2,by.x="eid",by.y="SAMPLE")
dim(df)
#393572     23   21 intersection between 429K with lipids and folks with prs and phenotypes
## missing lipid info
nrow(m2)-nrow(df)
n=nrow(df)
## now remove statin folks
dim(df[which(df$statin0==1),])
df=df[-which(df$statin0==1),]
dim(df)
# 329740     23
## on statin
n-nrow(df)
## compute ascvd scores
df$sex=ifelse(as.factor(df$sex)=="Male","male","female")
df$old_smoke=df$smoke
df$smoke=ifelse(df$smoke==2,1,0)
df$SCORESUM=df$prs=df$SCORE
#df$prs_quant=(df$SCORESUM-mean(df$SCORESUM))/sd(df$SCORESUM)
df$prs_quant=(scale(df$prs))
df$prs.r=(rank(df$prs_quant)/length(df$prs_quant))
df$phenos.CAD_censor_age=df$censor_age
df$age.r=(rank(df$phenos.CAD_censor_age)/length(df$prs_quant))
df$ldladj.r=(rank(df$ldladj)/length(df$ldladj))
rownames(df)=as.character(df$eid)
mean(df$dbp)
82.84082
sd(df$dbp)
11.26724
mean(df$trigadj)
151.8712
sd(df$trigadj)
90.27076
df2=compute_CVrisk(df,scores = c("ascvd_10y_accaha"),
age = "phenos.enrollment", race = "Race", gender = "sex", bmi = "bmi", sbp = "sbp",hdl = "hdladj", totchol = "choladj", bp_med = "bp_med", smoker = "smoke",
diabetes = "prev_disease_dm", lipid_med = "anylipidmed0",
fh_heartattack = NULL, cac = NULL)
df3=compute_CVrisk2(df,scores = c("as2"),
age = "phenos.enrollment", race = "Race", gender = "sex", bmi = "bmi", sbp = "sbp",hdl = "hdladj", totchol = "choladj", bp_med = "bp_med", smoker = "smoke",
diabetes = "prev_disease_dm", lipid_med = "anylipidmed0",
fh_heartattack = NULL, cac = NULL)
df$ascvd_10y_accaha=df2$ascvd_10y_accaha
df$ascvd_10y_accaha_all=df3$as2
df$ascvd.r=rank(df$ascvd_10y_accaha)/length(df$ascvd_10y_accaha)
df$ascvdcat_all <- cut(df$ascvd_10y_accaha_all, breaks=c(0, 7.5, 20,Inf), labels=c("low", "intermediate","high"))
df$ascvdcat <- cut(df$ascvd_10y_accaha, breaks=c(0, 7.5, 20,Inf), labels=c("low", "intermediate","high"))
df$prscat <- cut(df$prs.r, breaks=c(0, 0.20,0.80,0.975,1), labels=c("low", "intermediate","int-high","high"))
df$prscat <- cut(df$prs.r, breaks=c(0, 0.20,0.80,1), labels=c("low", "intermediate","high"))
df$age_to_censor=df$phenos.CAD_censor_age-df$phenos.enrollment
sum(df$age_to_censor<0)
dfc=df[-which(df$age_to_censor<0),]
#
#
# dim(dfc)
# dim(dfc)
#saveRDS(dfc,"~/Dropbox/paper_scripts/output/amit_df.rds")
saveRDS(dfc,"~/Dropbox/paper_scripts/output/amit_df_tgdbp.rds")
library(table1)
library(table1)
library(magrittr)
library("flextable")
ls()
library(CVrisk)
df2=compute_CVrisk(df,scores = c("ascvd_10y_accaha"),
age = "phenos.enrollment", race = "Race", gender = "sex", bmi = "bmi", sbp = "sbp",hdl = "hdladj", totchol = "choladj", bp_med = "bp_med", smoker = "smoke",
diabetes = "prev_disease_dm", lipid_med = "anylipidmed0",
fh_heartattack = NULL, cac = NULL)
df3=compute_CVrisk2(df,scores = c("as2"),
age = "phenos.enrollment", race = "Race", gender = "sex", bmi = "bmi", sbp = "sbp",hdl = "hdladj", totchol = "choladj", bp_med = "bp_med", smoker = "smoke",
diabetes = "prev_disease_dm", lipid_med = "anylipidmed0",
fh_heartattack = NULL, cac = NULL)
df$ascvd_10y_accaha=df2$ascvd_10y_accaha
df$ascvd_10y_accaha_all=df3$as2
df$ascvd.r=rank(df$ascvd_10y_accaha)/length(df$ascvd_10y_accaha)
df$ascvdcat_all <- cut(df$ascvd_10y_accaha_all, breaks=c(0, 7.5, 20,Inf), labels=c("low", "intermediate","high"))
df$ascvdcat <- cut(df$ascvd_10y_accaha, breaks=c(0, 7.5, 20,Inf), labels=c("low", "intermediate","high"))
df$prscat <- cut(df$prs.r, breaks=c(0, 0.20,0.80,0.975,1), labels=c("low", "intermediate","int-high","high"))
df$prscat <- cut(df$prs.r, breaks=c(0, 0.20,0.80,1), labels=c("low", "intermediate","high"))
df$age_to_censor=df$phenos.CAD_censor_age-df$phenos.enrollment
sum(df$age_to_censor<0)
dfc=df[-which(df$age_to_censor<0),]
#
#
# dim(dfc)
# dim(dfc)
#saveRDS(dfc,"~/Dropbox/paper_scripts/output/amit_df.rds")
saveRDS(dfc,"~/Dropbox/paper_scripts/output/amit_df_tgdbp.rds")
#####
dim(dfc)
df2=readRDS("output/amit_df_tgbdbp.rds")
df2=readRDS("~/Dropbox/output/amit_df_tgbdbp.rds")
df2=readRDS("~/Dropbox/paper_scripts/output/amit_df_tgbdbp.rds")
saveRDS(dfc,"paper_scripts/output/amit_df_tgdbp.rds")
saveRDS(dfc,file = "paper_scripts/output/amit_df_tgdbp.rds")
saveRDS(dfc,file = "~/paper_scripts/output/amit_df_tgdbp.rds")
saveRDS(dfc,file = "~/paperscripts//output/amit_df_tgdbp.rds")
df2=readRDS("paperscripts/output/amit_df_tgbdbp.rds")
df2=readRDS("~/paperscripts/output/amit_df_tgbdbp.rds")
df2=readRDS("~/paperscripts/output/amit_df_tgdbp.rds")
df=readRDS("output/amit_df_bp.rds")
dat=df
df2=readRDS("~/paperscripts/output/amit_df_tgdbp.rds")
dat$age=df$phenos.enrollment
dat$dm    <- factor(dat$prev_disease_dm, levels=0:1, labels=c("None", "Diabetes Mellitus"))
dat$sex     <- factor(dat$sex, levels=c("male", "female"), labels=c("Male", "Female"))
dat$prscat  <- factor(dat$prscat,  labels=c("Low","Intermediate", "High"))
dat$Race  <- factor(dat$Race,levels=c("other","white"),labels=c("Non-white","White"))
dat$ascvdcat   <- factor(dat$ascvdcat_all,
labels=c("<7.5",
"7.5-20",
"20+"))
dat$smoke=factor(dat$old_smoke,levels=c(-3,0,1,2),
labels=c("Never","Never","Former",
"Current"))
dat$bp_med=factor(dat$bp_med2,levels=c(0,1),labels=c("No","Yes"))
dat$follow=dat$phenos.CAD_censor_age-dat$phenos.enrollment
t=table1(~ age + sex + sbp + choladj + hdladj + smoke + ascvdcat+
ldladj + bp_med+dm+prscat+race |ascvdcat, data=dat)
t=table1(~ age + sex + prscat + sbp + race + choladj + hdladj + smoke + ascvdcat+
ldladj + bp_med+Race, data=dat)
t=table1(~ age + sex + prscat + sbp + race + choladj + hdladj + smoke + ascvdcat+
ldladj + bp_med+Race, data=dat)
t=table1(~ age + sex + prscat + sbp + Race + choladj + hdladj + smoke + ascvdcat+
ldladj + bp_med, data=dat)
t
table1(~ age + sex + prscat + sbp + Race + choladj + hdladj + smoke + ascvdcat+
ldladj + bp_med+trigadj+dbp, data=df2)
table1(~trigadj+dbp, data=df2)
table1(~trigadj+dbp|ascvdcat, data=df2)
head(df3)
head(df2)
table1(~trigadj+dbp|ascvdcat, data=na.omit(df2))
label(df2$dbp)="Diastolic BP (mmHg)"
table1(~trigadj+dbp, data=df2)
label(df2$trigadj)="Triglyverides (ng/ml)"
label(df2$dbp)="Diastolic BP (mmHg)"
label(df2$trigadj)="Triglycerides (ng/ml)"
label(df2$dbp)="Diastolic BP (mmHg)"
table1(~trigadj+dbp, data=df2)
table1(~trigadj+dbp|ascvdcat, data=na.omit(df2))
rbind(t,t2)
###
t=table1(~ age + sex + sbp + choladj + hdladj + smoke + ascvdcat+
ldladj + bp_med+dm+prscat+race |ascvdcat, data=dat)
t1flex(t) %>%
save_as_docx(path="Figs/Tables/UKBB_table1_byASCVD.docx")
t2=table1(~trigadj+dbp|ascvdcat, data=na.omit(df2))
rbind(t,t2)
t2=table1(~trigadj+dbp|ascvdcat, data=na.omit(df2))
t1flex(t2) %>%
save_as_docx(path="Figs/Tables/UKBB_table1_byASCVD_dbp.docx")
t2=table1(~trigadj+dbp|prscat, data=na.omit(df2))
t1flex(t2) %>%
save_as_docx(path="Figs/Tables/UKBB_table1_byprs_dbp.docx")
t=table1(~ age + sex  + sbp + smoke +dm + ascvdcat+hdladj
ldladj + bp_med + Race|prscat, data=dat)
t=table1(~ age + sex  + sbp + smoke +dm + ascvdcat+hdladj+
ldladj + bp_med + Race|prscat, data=dat)
t1flex(t) %>%
save_as_docx(path="Figs/Tables/UKBB_table1_byPRS.docx")
t=table1(~ age + sex + sbp+prscat + ascvdcat+ bp_med+Race + smoke+choladj + hdladj + ldladj,data=dat)
t
df=readRDS("output/amit_df_bp.rds")
dat=df
df2=readRDS("~/paperscripts/output/amit_df_tgdbp.rds")
label(df2$trigadj)="Triglycerides (ng/ml)"
label(df2$dbp)="Diastolic BP (mmHg)"
dat$age=df$phenos.enrollment
dat$dm    <- factor(dat$prev_disease_dm, levels=0:1, labels=c("None", "Diabetes Mellitus"))
dat$sex     <- factor(dat$sex, levels=c("male", "female"), labels=c("Male", "Female"))
dat$prscat  <- factor(dat$prscat,  labels=c("Low","Intermediate", "High"))
dat$Race  <- factor(dat$Race,levels=c("other","white"),labels=c("Non-white","White"))
dat$ascvdcat   <- factor(dat$ascvdcat_all,
labels=c("<7.5",
"7.5-20",
"20+"))
dat$smoke=factor(dat$old_smoke,levels=c(-3,0,1,2),
labels=c("Never","Never","Former",
"Current"))
dat$bp_med=factor(dat$bp_med2,levels=c(0,1),labels=c("No","Yes"))
dat$follow=dat$phenos.CAD_censor_age-dat$phenos.enrollment
label(dat$age)      <- "Age (y)"
label(dat$sex)      <- "Sex"
label(dat$prscat)    <- "Polygenic score category"
label(dat$dm)    <- "Diabetes status"
label(dat$sbp)  <- "Systolic blood pressure (mm Hg) "
label(dat$choladj)   <- "Total cholesterol (ng/ml)"
label(dat$hdladj)  <- "High-density lipoprotein (ng/ml)"
label(dat$smoke) <- "Smoking Status"
label(dat$ldladj)  <- "Low-density lipoprotein (ng/ml)"
label(dat$bp_med)  <- "Anti-hypertensive"
label(dat$ascvdcat)  <- "Pooled cohort equation category (10 year risk)"
t=table1(~ age + sex + sbp+prscat + ascvdcat+ bp_med+Race + smoke+choladj + hdladj + ldladj,data=dat)
t
t1flex(t) %>%
save_as_docx(path="Figs/Tables/UKBB_table1.docx")
t=table1(~ age + sex + sbp+prscat +dm+bp_med+Race + smoke+choladj + hdladj + ldladj|ascvdcat, data=dat)
t1flex(t) %>%
save_as_docx(path="Figs/Tables/UKBB_table1_byASCVD.docx")
head(fwk)
fwk=read.table("~/Desktop//Framingham/85598/PhenoGenotypeFiles/RootStudyConsentSet_phs000007.Framingham.v32.p13.c1.HMB-IRB-MDS/PhenotypeFiles/phs000007.v32.pht006027.v3.p13.c1.vr_wkthru_ex09_1_1001s.HMB-IRB-MDS.txt",header = T,skip = 1,sep="\t")
mean(fwk$DBP1)
mean(na.omit(fwk$DBP1))
sd(na.omit(fwk$DBP1))
sd(na.omit(fwk$TRIG1))
mean(na.omit(fwk$TRIG1))
> mean(na.omit(fwk$CALC_LDL1))
[1] 99.13985
> sd(na.omit(fwk$CALC_LDL1))
> mean(na.omit(fwk$CALC_LDL1))
> sd(na.omit(fwk$CALC_LDL1))
mean(na.omit(fwk$CALC_LDL1))
sd(na.omit(fwk$CALC_LDL1))
t1flex(t)%>%save_as_pptx("Figs/Tables/UKBB_table1_byASCVD.pptx")
t1flex(t)%>%save_as_pptx(path="Figs/Tables/UKBB_table1_byASCVD.pptx")
export(t,file = "Figs/Tables/UKBB_table1_byASCVD.csv")
orca(t,file = "Figs/Tables/UKBB_table1_byASCVD.csv")
kaleidot,file = "Figs/Tables/UKBB_table1_byASCVD.csv")
kaleido(t),file = "Figs/Tables/UKBB_table1_byASCVD.csv")
kaleido(t,file = "Figs/Tables/UKBB_table1_byASCVD.csv")
gplot2 <- ggplot(m2,aes(x = Age,y = AUC,color = Model,ymin=AUC+se,ymax=AUC-se))+geom_point()+geom_line(aes(group=Model,color =Model),linewidth=3)+geom_pointrange()+ylim(0.5,0.8)+scale_color_manual(values=c("tomato","cornflowerblue","darkorchid4"))+theme_classic(base_size = 25)+theme(axis.text.x = element_text(angle = 90))+labs(x="Age at risk estimation, years",y="AUC")
ggsave(gplot2,filename = "Figs/Fig5/aucplot_onlytwo.tiff",dpi=300,width = 9,height = 7)
source("code/utils.R")
library(ggplot2)
df=readRDS("output/amit_df.rds")
ages=c(40,45,50,55,60,65,70,75)
df$prscat <- cut(df$prs.r, breaks=c(0, 0.20,0.80,1), labels=c("low", "intermediate","high"))
set.seed(456)
aucmat=matrix(NA,nrow=length(ages)-1,ncol=3)
semat=matrix(NA,nrow=length(ages)-1,ncol=3)
for(i in 1:(length(ages)-1))
{
par(mfrow=c(1,2))
#which(df$phenos.enrollment>ages[i]&df$phenos.enrollment<ages[i+1])
d=df[which(df$phenos.enrollment>ages[i]&df$phenos.enrollment<ages[i+1]),]
indices=sample(nrow(d))
d_train=d[indices[1:(length(indices)/2)],]
d_test=d[indices[(length(indices)/2+1):length(indices)],]
model_glm = glm(phenos.has_CAD  ~ prscat, data = d_train, family = "binomial")
test_prob = predict(model_glm, newdata = d_test, type = "response")
test_roc = roc(d_test$phenos.has_CAD~ test_prob, plot = F,main=paste0("PRS,age",ages[i],"to",ages[i+1]))
aucmat[i,1]=test_roc$auc
semat[i,1]=sqrt(var(test_roc))
model_glm = glm(phenos.has_CAD  ~ ascvdcat_all, data = d_train, family = "binomial")
test_prob = predict(model_glm, newdata = d_test, type = "response")
test_roc = roc(d_test$phenos.has_CAD~ test_prob, plot = F,main=paste0("PCE,age",ages[i],"to",ages[i+1]))
aucmat[i,2]=test_roc$auc
semat[i,2]=sqrt(var(test_roc))
model_glm = glm(phenos.has_CAD  ~ ascvdcat_all+prscat, data = d_train, family = "binomial")
test_prob = predict(model_glm, newdata = d_test, type = "response")
test_roc = roc(d_test$phenos.has_CAD~ test_prob, plot = F,main=paste0("PCE+PRS,age",ages[i],"to",ages[i+1]))
aucmat[i,3]=test_roc$auc
semat[i,3]=sqrt(var(test_roc))
}
rownames(aucmat)=c("40-45","45-50","50-55","55-60","60-65","65-70","70-75")
m=melt(aucmat,id.vars="Age")
m3=melt(semat)
m[which(m$X2==1),2]="PRS"
m[which(m$X2==2),2]="PCE"
m[which(m$X2==3),2]="PRS+PCE"
names(m)=c("Age","Model","AUC")
m$Model=as.factor(m$Model)
levels(m$Model)[1]="Genomic"
levels(m$Model)[2]="Non Genomic"
levels(m$Model)[3]="Combined"
m$se=m3$value
gplot <- ggplot(m,aes(x = Age,y = AUC,color = Model,ymin=AUC+se,ymax=AUC-se))+geom_point()+geom_line(aes(group=Model,color =Model),linewidth=3)+geom_pointrange()+ylim(0.5,1)+scale_color_manual(values=c("tomato","cornflowerblue","darkorchid4"))+theme_classic(base_size = 25)+theme(axis.text.x = element_text(angle = 90))
ggplotly(gplot)
#ggsave(gplot,filename = "aucplot.pdf",dpi=300)
ggsave(gplot,filename = "Figs/Fig5/aucplot.tiff",dpi=300,width = 9,height = 7)
msave=m
msave$upper=m$AUC+m$se
msave$lower=m$AUC-m$se
write.table(msave,"output/AUC.csv",sep=",",quote=FALSE,row.names = F)
```
```{r}
tgt = c("Non Genomic","Combined")
m2 = m %>% filter(Model %in% tgt)
m2$Model=factor(m2$Model)
levels(m2$Model)=c("Clinical","Clinical + Genomic")
gplot2 <- ggplot(m2,aes(x = Age,y = AUC,color = Model,ymin=AUC+se,ymax=AUC-se))+geom_point()+geom_line(aes(group=Model,color =Model),linewidth=3)+geom_pointrange()+ylim(0.5,0.8)+scale_color_manual(values=c("tomato","cornflowerblue","darkorchid4"))+theme_classic(base_size = 25)+theme(axis.text.x = element_text(angle = 90))+labs(x="Age at risk estimation, years",y="AUC")
ggsave(gplot2,filename = "Figs/Fig5/aucplot_onlytwo.tiff",dpi=300,width = 9,height = 7)
dyoung=df[df$phenos.enrollment<55,]
dyoung$pce.age=scale(dyoung$ascvd_10y_accaha_all)
dyoung$pce.r=rank(dyoung$pce.age)/length(dyoung$pce.age)
dyoung$pce.cat=cut(dyoung$pce.r,breaks=c(0,0.20,0.80,1))
dyoung=df[df$phenos.enrollment<55,]
dyoung$pce.age=scale(dyoung$ascvd_10y_accaha_all)
dyoung$pce.r=rank(dyoung$pce.age)/length(dyoung$pce.age)
dyoung$pce.cat=cut(dyoung$pce.r,breaks=c(0,0.20,0.80,1))
fit <- survfit(Surv((phenos.CAD_censor_age-phenos.enrollment), phenos.has_CAD)~ascvdcat_all, data=dyoung)
q=rbind(quantile(dyoung$ascvd_10y_accaha_all,probs = seq(0,1,by=0.10)),quantile(df$ascvd_10y_accaha_all[df$phenos.enrollment>55&df$phenos.enrollment<65],probs = seq(0,1,by=0.10)),quantile(df$ascvd_10y_accaha_all[df$phenos.enrollment>65],probs = seq(0,1,by=0.10)))
q=data.frame(t(q))
colnames(q)=c("<55","55-65","65+")
q$rank=seq(0,100,by=10)
qm=melt(q,id.vars = "rank")
barplot(q,beside = T)
q$age=c("<55","55-65",">65")
p=ggplot(qm,aes(x=rank,y=value,fill=variable,color=variable))+geom_bar(stat="identity",pos="dodge")+scale_fill_futurama()+theme_classic(base_size = 20)+labs(y="10-year Predicted ASCVD Risk",x="Rank Decile for Age",fill="Age Category")+guides(color="none")+geom_hline(yintercept = 7.5)
ggsave(p,filename = "output/ageascvddist.tiff",dpi=300)
q
p
